<section class="max-w-3xl mx-auto px-4 py-8 select-none">
  <div class="flex items-start justify-between gap-4 mb-6">
    <div class="text-sm text-gray-700">
      <p class="font-medium">Este é um rastreador informativo.</p>
      <p>Se houver <strong>risco imediato</strong>, ligue <strong>190</strong>.</p>
    </div>

    <button type="button" (click)="panicExit()"
      class="inline-flex items-center px-3 py-2 rounded border text-sm hover:bg-gray-100 transition-colors hover:cursor-pointer"
      aria-label="Sair rápido: fechar esta página e abrir um site neutro">
      Sair rápido
    </button>
  </div>

  <header class="mb-8">
    <h1 class="text-2xl font-bold">Teste de vulnerabilidade</h1>
    <p class="text-gray-700 mt-2">Leva ~2 minutos. Não armazenamos suas respostas.</p>
  </header>

  <aside class="rounded-lg bg-yellow-50 border border-yellow-200 p-4 mb-6 text-sm text-yellow-900">
    <p><strong>Privacidade:</strong> as respostas são processadas apenas no seu dispositivo e não são salvas. Você pode
      pular qualquer item.</p>
  </aside>

  <form (submit)="submit($event)" novalidate>
    <fieldset class="space-y-6">
      <legend class="sr-only">Perguntas</legend>

      <ng-container *ngFor="let q of questions; trackBy: trackById; let i = index">
        <div class="rounded-lg border p-4">
          <label [attr.for]="'q-' + q.id" class="block text-base font-medium">
            {{ i + 1 }}. {{ q.text }}
            <span *ngIf="q.critical" class="ml-2 inline-block text-xs px-2 py-0.5 rounded-full border">
              item crítico
            </span>
          </label>

          <div class="w-full mt-3 flex flex-col md:flex-row items-center justify-between gap-2" role="radiogroup"
            [attr.aria-labelledby]="'q-' + q.id">
            <ng-container *ngFor="let opt of likert">
              <input class="sr-only" type="radio" [name]="'q-' + q.id" [id]="'q-' + q.id + '-' + opt.value"
                [value]="opt.value" (change)="setAnswer(q.id, opt.value)">
              <label
                class="text-center border w-full rounded-lg px-2 py-3 grow cursor-pointer select-none focus:outline-none focus:ring"
                [for]="'q-' + q.id + '-' + opt.value" [class.bg-gray-900]="answers()[q.id] === opt.value"
                [class.text-white]="answers()[q.id] === opt.value" [class.opacity-60]="answers()[q.id] === null"
                [title]="opt.label">
                <div class="text-sm font-medium truncate">{{ opt.label }}</div>
                <div class="text-xs mt-1">{{ opt.helper }}</div>
              </label>
            </ng-container>
          </div>
        </div>
      </ng-container>
    </fieldset>

    <div class="mt-6 flex items-center justify-between text-sm">
      <div>Respondidas: <strong>{{ answeredCount() }}</strong> / {{ total }}</div>
      <div class="w-48 h-2 bg-gray-200 rounded">
        <div class="h-2 bg-gray-900 rounded" [style.width.%]="progressPct()"></div>
      </div>
    </div>

    <div class="mt-8 flex flex-col sm:flex-row gap-3">
      <button type="submit"
        class="px-4 py-3 rounded-lg border bg-gray-900 text-white disabled:opacity-50 hover:bg-gray-700 transition-colors hover:cursor-pointer"
        [disabled]="answeredCount() === 0">
        Ver resultado
      </button>
      <button type="button" class="px-4 py-3 rounded-lg border hover:bg-gray-100 transition-colors hover:cursor-pointer"
        (click)="reset()">Limpar respostas</button>
    </div>
  </form>

  <section *ngIf="result()" class="mt-10 rounded-lg border p-6">
    <h2 class="text-xl font-bold mb-2">Seu resultado</h2>
    <p class="text-gray-700 mb-4">{{ result()!.label }}</p>

    <div class="grid sm:grid-cols-2 gap-3 mb-4">
      <a class="px-4 py-3 rounded-lg border text-center hover:bg-gray-100 transition-colors" href="tel:190"
        rel="nofollow">Ligar 190 (emergência)</a>

      <a class="px-4 py-3 rounded-lg border text-center hover:bg-gray-100 transition-colors" href="tel:180"
        rel="nofollow">Ligar 180
        (orientação/denúncia)</a>

      <a class="px-4 py-3 rounded-lg border text-center hover:bg-gray-100 transition-colors"
        href="https://wa.me/556196100180" target="_blank" rel="noopener">WhatsApp 180</a>

      <a class="px-4 py-3 rounded-lg border text-center hover:bg-gray-100 transition-colors"
        href="mailto:central180&#64;mulheres.gov.br">central180&#64;mulheres.gov.br</a>
    </div>

    <details class="mb-4">
      <summary class="cursor-pointer font-medium">Plano de segurança rápido</summary>
      <ul class="list-disc pl-5 mt-2 text-sm">
        <li>Combine um sinal/código com alguém de confiança.</li>
        <li>Separe documentos essenciais e um kit de saída.</li>
        <li>Defina rotas e locais seguros.</li>
        <li>Registre ocorrências (prints, datas, horários).</li>
        <li>Se houver arma, ameaça de morte ou estrangulamento, priorize acionar 190.</li>
      </ul>
    </details>
  </section>
</section>